<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador Microeconom√©trico Brasil 2025 (Completo)</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body { background-color: #f8f9fa; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .card { box-shadow: 0 8px 16px rgba(0,0,0,0.08); border: none; border-radius: 15px; }
        .header-bg { background: linear-gradient(135deg, #0d6efd, #0043a8); color: white; padding: 3rem 0; margin-bottom: 2rem; }
        
        /* Estilos da Calculadora */
        .result-box { 
            background-color: #ffffff; 
            border: 1px solid #dee2e6;
            border-left: 5px solid #198754;
            border-radius: 8px; 
            padding: 30px; 
            text-align: center; 
            display: none; 
            margin-top: 30px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            animation: fadeIn 0.6s ease-out;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .result-value { font-size: 3.5rem; font-weight: 800; color: #198754; letter-spacing: -1px; margin: 10px 0; }
        .badge-uf { background-color: #e7f1ff; color: #0d6efd; padding: 6px 12px; border-radius: 30px; font-size: 0.9rem; font-weight: 700; text-transform: uppercase; }
        .badge-modelo { background-color: #fff3cd; color: #856404; padding: 5px 10px; border-radius: 20px; font-size: 0.8rem; font-weight: bold; margin-bottom: 10px; display: inline-block; }

        /* Estilos da Simula√ß√£o (Cards de Insight) */
        .analysis-card { 
            background: #fff; 
            border-left: 5px solid #6f42c1; 
            padding: 15px; 
            margin-bottom: 10px; 
            border-radius: 4px; 
            font-size: 0.95rem; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            animation: fadeIn 0.5s ease;
        }

        /* Bot√µes e Navega√ß√£o */
        .btn-calc { padding: 15px; font-size: 1.2rem; font-weight: 700; transition: all 0.3s; }
        .btn-calc:hover { transform: translateY(-2px); box-shadow: 0 4px 10px rgba(13, 110, 253, 0.3); }
        .nav-pills .nav-link { color: #495057; font-weight: 600; padding: 12px 25px; border-radius: 30px; margin: 0 5px; }
        .nav-pills .nav-link.active { background-color: #0d6efd; color: white; }
        
        #chart-container { position: relative; height: 500px; width: 100%; margin-top: 20px; }
        footer a { color: inherit; text-decoration: none; border-bottom: 1px dotted #6c757d; }
    </style>
</head>
<body class="d-flex flex-column min-vh-100">

    <div class="header-bg text-center">
        <h1 class="fw-bold display-5">üí∞ Microeconometria Aplicada</h1>
        <p class="lead opacity-90">Simuladores baseados na PNADc 2025 e Equa√ß√µes de Mincer</p>
    </div>

    <div class="container pb-5 flex-grow-1">
        
        <ul class="nav nav-pills justify-content-center mb-5" id="pills-tab" role="tablist">
            <li class="nav-item">
                <button class="nav-link active" id="pills-calc-tab" data-bs-toggle="pill" data-bs-target="#pills-calc" type="button">Calculadora Instant√¢nea</button>
            </li>
            <li class="nav-item">
                <button class="nav-link" id="pills-sim-tab" data-bs-toggle="pill" data-bs-target="#pills-sim" type="button" onclick="simularVida()">Custo de Oportunidade (Vida)</button>
            </li>
        </ul>

        <div class="tab-content" id="pills-tabContent">
            
            <div class="tab-pane fade show active" id="pills-calc" role="tabpanel">
                <div class="row justify-content-center">
                    <div class="col-md-8 col-lg-7">
                        <div class="card p-4 p-md-5">
                            <form id="salaryForm">
                                <div class="row g-4 mb-4">
                                    <div class="col-12"><h5 class="text-primary fw-bold border-bottom pb-2">1. Perfil Demogr√°fico</h5></div>
                                    
                                    <div class="col-12">
                                        <label class="form-label fw-bold text-danger">Cor / Ra√ßa (Define o Modelo)</label>
                                        <select class="form-select form-select-lg border-danger" id="cor">
                                            <option value="branca">Branca</option>
                                            <option value="amarela">Amarela (Asi√°tica)</option>
                                            <option value="preta">Preta / Parda</option>
                                            <option value="indigena">Ind√≠gena</option>
                                        </select>
                                    </div>

                                    <div class="col-md-6">
                                        <label class="form-label fw-bold text-secondary">Idade</label>
                                        <input type="number" class="form-control form-control-lg" id="idade" value="30" min="14" max="80">
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold text-secondary">Escolaridade</label>
                                        <select class="form-select form-select-lg" id="estudo">
                                            <option value="0">Sem instru√ß√£o</option>
                                            <option value="4">Fundamental Incompleto</option>
                                            <option value="9">Fundamental Completo</option>
                                            <option value="12" selected>M√©dio Completo</option>
                                            <option value="16">Superior Completo</option>
                                            <option value="18">Mestrado/Doutorado</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold text-secondary">G√™nero</label>
                                        <select class="form-select form-select-lg" id="sexo">
                                            <option value="homem">Homem</option>
                                            <option value="mulher">Mulher</option>
                                        </select>
                                    </div>
                                    
                                    <div class="col-12"><h5 class="text-primary fw-bold border-bottom pb-2 mt-3">2. Mercado de Trabalho</h5></div>
                                    
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold text-secondary">Estado (UF)</label>
                                        <select class="form-select form-select-lg" id="uf">
                                            <option value="11">Rond√¥nia (RO)</option>
                                            <option value="12">Acre (AC)</option>
                                            <option value="13">Amazonas (AM)</option>
                                            <option value="14">Roraima (RR)</option>
                                            <option value="15">Par√° (PA)</option>
                                            <option value="16">Amap√° (AP)</option>
                                            <option value="17">Tocantins (TO)</option>
                                            <option value="21">Maranh√£o (MA)</option>
                                            <option value="22">Piau√≠ (PI)</option>
                                            <option value="23">Cear√° (CE)</option>
                                            <option value="24">Rio Grande do Norte (RN)</option>
                                            <option value="25">Para√≠ba (PB)</option>
                                            <option value="26">Pernambuco (PE)</option>
                                            <option value="27">Alagoas (AL)</option>
                                            <option value="28">Sergipe (SE)</option>
                                            <option value="29">Bahia (BA)</option>
                                            <option value="31">Minas Gerais (MG)</option>
                                            <option value="32">Esp√≠rito Santo (ES)</option>
                                            <option value="33">Rio de Janeiro (RJ)</option>
                                            <option value="35" selected>S√£o Paulo (SP)</option>
                                            <option value="41">Paran√° (PR)</option>
                                            <option value="42">Santa Catarina (SC)</option>
                                            <option value="43">Rio Grande do Sul (RS)</option>
                                            <option value="50">Mato Grosso do Sul (MS)</option>
                                            <option value="51">Mato Grosso (MT)</option>
                                            <option value="52">Goi√°s (GO)</option>
                                            <option value="53">Distrito Federal (DF)</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold text-secondary">Setor</label>
                                        <select class="form-select form-select-lg" id="setor">
                                            <option value="1">Agricultura/Pecu√°ria</option>
                                            <option value="2">Ind√∫stria Extrativa</option>
                                            <option value="3" selected>Ind√∫stria Transforma√ß√£o</option>
                                            <option value="4">Eletricidade e G√°s</option>
                                            <option value="5">√Ågua/Esgoto/Res√≠duos</option>
                                            <option value="6">Constru√ß√£o Civil</option>
                                            <option value="7">Com√©rcio</option>
                                            <option value="8">Transporte/Correio</option>
                                            <option value="9">Alojamento/Alimenta√ß√£o</option>
                                            <option value="10">Informa√ß√£o/Comunica√ß√£o</option>
                                            <option value="11">Adm. P√∫blica</option>
                                            <option value="12">Educa√ß√£o/Sa√∫de/Sociais</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="d-grid mt-4">
                                    <button type="button" class="btn btn-primary btn-calc shadow" onclick="calcularSalario()">Calcular Agora</button>
                                </div>
                            </form>

                            <div id="resultado" class="result-box">
                                <span class="badge-modelo" id="infoModelo">...</span><br>
                                <span class="badge-uf" id="badgeUF">M√©dia Estimada</span>
                                <div class="result-value" id="valorEstimado">R$ 0,00</div>
                                <div class="text-muted small">
                                    Faixa prov√°vel (95%): <strong id="faixaMin">R$ 0</strong> a <strong id="faixaMax">R$ 0</strong>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="pills-sim" role="tabpanel">
                <div class="row justify-content-center">
                    <div class="col-lg-10">
                        <div class="card p-4">
                            <h4 class="mb-3">Custo de Oportunidade e Pontos de Virada</h4>
                            <p class="text-muted">An√°lise comparativa de renda vital√≠cia baseada no modelo estratificado selecionado.</p>
                            
                            <div class="row g-3 p-3 bg-light rounded mb-4 border align-items-end">
                                <div class="col-md-4">
                                    <label class="form-label fw-bold small text-danger">Modelo Racial</label>
                                    <select class="form-select border-danger" id="sim_cor">
                                        <option value="branca">Branca</option>
                                        <option value="amarela">Amarela</option>
                                        <option value="preta">Preta / Parda</option>
                                        <option value="indigena">Ind√≠gena</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label fw-bold small">Estado Base</label>
                                    <select class="form-select" id="sim_uf">
                                        <option value="11">Rond√¥nia (RO)</option>
                                            <option value="12">Acre (AC)</option>
                                            <option value="13">Amazonas (AM)</option>
                                            <option value="14">Roraima (RR)</option>
                                            <option value="15">Par√° (PA)</option>
                                            <option value="16">Amap√° (AP)</option>
                                            <option value="17">Tocantins (TO)</option>
                                            <option value="21">Maranh√£o (MA)</option>
                                            <option value="22">Piau√≠ (PI)</option>
                                            <option value="23">Cear√° (CE)</option>
                                            <option value="24">Rio Grande do Norte (RN)</option>
                                            <option value="25">Para√≠ba (PB)</option>
                                            <option value="26">Pernambuco (PE)</option>
                                            <option value="27">Alagoas (AL)</option>
                                            <option value="28">Sergipe (SE)</option>
                                            <option value="29">Bahia (BA)</option>
                                            <option value="31">Minas Gerais (MG)</option>
                                            <option value="32">Esp√≠rito Santo (ES)</option>
                                            <option value="33">Rio de Janeiro (RJ)</option>
                                            <option value="35" selected>S√£o Paulo (SP)</option>
                                            <option value="41">Paran√° (PR)</option>
                                            <option value="42">Santa Catarina (SC)</option>
                                            <option value="43">Rio Grande do Sul (RS)</option>
                                            <option value="50">Mato Grosso do Sul (MS)</option>
                                            <option value="51">Mato Grosso (MT)</option>
                                            <option value="52">Goi√°s (GO)</option>
                                            <option value="53">Distrito Federal (DF)</option>
                                        </select>
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label fw-bold small">Infla√ß√£o (%)</label>
                                    <input type="number" id="sim_inflacao" class="form-control" value="5.5" step="0.5">
                                </div>
                                <div class="col-md-3">
                                    <button class="btn btn-success w-100 fw-bold shadow-sm" onclick="simularVida()">Gerar An√°lise</button>
                                </div>
                            </div>

                            <div id="chart-container">
                                <canvas id="lifeChart"></canvas>
                            </div>
                            
                            <div id="simulation-insights" class="mt-4"></div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <footer class="mt-auto py-4 bg-white border-top text-center text-secondary">
        <div class="container">
            <p class="mb-1 fw-bold text-dark">Jo√£o Vitor dos Santos Sobrinho <span class="fw-normal text-muted">(Economia/UEFS)</span></p>
            <p class="mb-0 small">Projeto acad√™mico de Microeconometria Aplicada.</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        let dadosJSON = null;
        let myChart = null;

        // 1. CARREGAR JSON
        fetch('modelo_salario_coeficientes_2025_geral.json')
            .then(res => {
                if(!res.ok) throw new Error("JSON n√£o encontrado");
                return res.json();
            })
            .then(data => {
                dadosJSON = data;
                console.log("Modelos carregados:", Object.keys(data));
            })
            .catch(err => alert("Erro ao carregar modelo: " + err.message));

        // ---------------------------------------------------------
        // FUN√á√ÉO 2: CALCULADORA (Aba 1)

function calcularSalario() {
    if (!dadosJSON) return alert("Aguarde o carregamento dos dados...");

    const raca = document.getElementById('cor').value;
    const idade = parseFloat(document.getElementById('idade').value);
    const anosEstudo = parseFloat(document.getElementById('estudo').value);
    const sexo = document.getElementById('sexo').value;
    const uf = document.getElementById('uf').value;
    const setor = document.getElementById('setor').value;

    const modeloAtual = dadosJSON[raca];
    if (!modeloAtual) return alert("Erro: Dados n√£o encontrados para " + raca);

    const coef = modeloAtual.coeficientes;
    const meta = modeloAtual.meta_info;

    let experiencia = Math.max(0, idade - anosEstudo - 6);
    let experiencia2 = experiencia * experiencia;

    let score = coef['const']; 

    if(coef['Anos_Estudo']) score += coef['Anos_Estudo'] * anosEstudo;
    if(coef['Experiencia']) score += coef['Experiencia'] * experiencia;
    if(coef['Experiencia_2']) score += coef['Experiencia_2'] * experiencia2;
    
    if (sexo === 'mulher' && coef['d_mulher']) score += coef['d_mulher'];
    if (coef[`UF_${uf}`]) score += coef[`UF_${uf}`];
    if (coef[`setor_${setor}`]) score += coef[`setor_${setor}`];

    if (coef['IMR']) score += coef['IMR'] * 0.6; 

    let salarioMedio = Math.exp(score) * 180; 
    
    // --- CORRE√á√ÉO AQUI ---
    let sigma = meta.sigma_resid || 0.65;
    if (sigma > 2.0) {
        console.warn("Sigma muito alto detectado (" + sigma + "). Ajustando para 0.65.");
        sigma = 0.65;
    }
    // ---------------------

    let min = Math.exp(score - 1.96 * sigma) * 180;
    let max = Math.exp(score + 1.96 * sigma) * 180;

    const fmt = new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' });
    
    document.getElementById('valorEstimado').innerText = fmt.format(salarioMedio);
    document.getElementById('faixaMin').innerText = fmt.format(min);
    document.getElementById('faixaMax').innerText = fmt.format(max);
    
    const nomes = { 'branca': 'Branca', 'amarela': 'Amarela', 'preta': 'Preta/Parda', 'indigena': 'Ind√≠gena' };
    document.getElementById('infoModelo').innerText = `Modelo Aplicado: ${nomes[raca]}`;
    
    // Atualiza nome da UF no Badge
    const selUF = document.getElementById('uf');
    const nomeUF = selUF.options[selUF.selectedIndex].text;
    document.getElementById('badgeUF').innerText = nomeUF;
    
    const box = document.getElementById('resultado');
    box.style.display = 'block';
    box.scrollIntoView({ behavior: 'smooth' });
}

        // ---------------------------------------------------------
        // FUN√á√ÉO 3: SIMULA√á√ÉO DE VIDA COMPLEXA (Aba 2)
        // ---------------------------------------------------------
        function simularVida() {
            if (!dadosJSON) return;

            const raca = document.getElementById('sim_cor').value;
            const inflacao = parseFloat(document.getElementById('sim_inflacao').value) / 100;
            const uf = document.getElementById('sim_uf').value; // Agora pega do select
            // Fixando setor m√©dio (Com√©rcio) e G√™nero (Homem) para isolar efeito educa√ß√£o
            const setor = "7"; 
            
            const modeloAtual = dadosJSON[raca];
            const coef = modeloAtual.coeficientes;

            // Perfis de Estudo
            const perfis = [
                { label: "M√©dio (12 anos)", anos: 12, inicio: 18, color: '#ffc107', data: [] },
                { label: "Superior (16 anos)", anos: 16, inicio: 23, color: '#0d6efd', data: [] }, // Come√ßa a trabalhar com 23
                { label: "Mestrado (18 anos)", anos: 18, inicio: 25, color: '#198754', data: [] }
            ];

            const labelsIdade = [];
            const salariosPorAno = 13; // 12 meses + 13¬∫

            // 1. Loop de C√°lculo (18 a 65 anos)
            for (let idade = 18; idade <= 65; idade++) {
                labelsIdade.push(idade);

                perfis.forEach(perfil => {
                    // Pega valor acumulado do ano anterior (ou 0 se for o primeiro)
                    let acumuladoAnterior = perfil.data.length > 0 ? perfil.data[perfil.data.length - 1] : 0;
                    
                    // Se idade < inicio da carreira, a pessoa n√£o ganha nada (Custo de Oportunidade)
                    if (idade < perfil.inicio) {
                        perfil.data.push(acumuladoAnterior); 
                    } else {
                        let exp = idade - perfil.anos - 6;
                        if (exp < 0) exp = 0;
                        let exp2 = exp * exp;

                        // Score Base
                        let s = coef['const'];
                        s += coef['Anos_Estudo'] * perfil.anos;
                        s += coef['Experiencia'] * exp;
                        s += coef['Experiencia_2'] * exp2;

                        // Controles Fixos para a Simula√ß√£o
                        if (coef[`UF_${uf}`]) s += coef[`UF_${uf}`];
                        if (coef[`setor_${setor}`]) s += coef[`setor_${setor}`];

                        let salarioReal = Math.exp(s) * 180;
                        
                        // Infla√ß√£o acumulada desde os 18 anos
                        let fatorInflacao = Math.pow(1 + inflacao, (idade - 18));
                        let salarioNominal = salarioReal * fatorInflacao;

                        let rendaAnual = salarioNominal * salariosPorAno;
                        perfil.data.push(acumuladoAnterior + rendaAnual);
                    }
                });
            }

            // 2. L√≥gica de Pontos de Virada (Cruzamento das curvas)
            const insightsContainer = document.getElementById('simulation-insights');
            insightsContainer.innerHTML = ''; // Limpa anterior
            const points = []; 

            const comparacoes = [
                { maior: perfis[1], menor: perfis[0], titulo: "Superior ultrapassa M√©dio", corPonto: '#ff7f0e' }, 
                { maior: perfis[2], menor: perfis[1], titulo: "Mestrado ultrapassa Superior", corPonto: '#d62728' } 
            ];

            comparacoes.forEach(comp => {
                for (let i = 0; i < labelsIdade.length; i++) {
                    // Se j√° come√ßou a trabalhar E acumulado maior ultrapassou menor
                    if (labelsIdade[i] > comp.maior.inicio && comp.maior.data[i] > comp.menor.data[i]) {
                        
                        let idadeVirada = labelsIdade[i];
                        let valorVirada = comp.maior.data[i];

                        let html = `
                            <div class="analysis-card" style="border-left-color: ${comp.corPonto}">
                                <strong style="color: ${comp.corPonto}">‚óè ${comp.titulo}</strong><br>
                                Idade de Virada: <b>${idadeVirada} anos</b><br>
                                Patrim√¥nio Acumulado (Sal√°rios): R$ ${(valorVirada/1000000).toFixed(2)} Milh√µes
                            </div>`;
                        insightsContainer.innerHTML += html;

                        points.push({ 
                            x: idadeVirada, 
                            y: valorVirada, 
                            labelLegend: comp.titulo, 
                            color: comp.corPonto
                        });
                        break; // Para de procurar ap√≥s achar o ponto de cruzamento
                    }
                }
            });

            renderizarGrafico(labelsIdade, perfis, points, raca);
        }

        // ---------------------------------------------------------
        // FUN√á√ÉO 4: RENDERIZAR GR√ÅFICO CUSTOMIZADO (Linhas + Pontos)
        // ---------------------------------------------------------
        function renderizarGrafico(labels, datasets, points, raca) {
            const ctx = document.getElementById('lifeChart').getContext('2d');
            if (myChart) myChart.destroy();

            // Dataset das Linhas
            const chartDatasets = datasets.map(d => ({
                label: d.label,
                data: d.data,
                borderColor: d.color,
                backgroundColor: d.color,
                borderWidth: 3,
                pointRadius: 0,
                tension: 0.4
            }));

            // Dataset dos Pontos de Virada (Scatter)
            points.forEach(p => {
                chartDatasets.push({
                    label: p.labelLegend,
                    data: [{x: p.x, y: p.y}],
                    type: 'scatter',
                    backgroundColor: p.color,
                    borderColor: '#fff',
                    borderWidth: 2,
                    pointRadius: 8,
                    pointHoverRadius: 10,
                    order: 0 
                });
            });

            myChart = new Chart(ctx, {
                type: 'line',
                data: { labels: labels, datasets: chartDatasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: 'nearest', axis: 'x', intersect: false },
                    plugins: {
                        title: { display: true, text: `Acumulado de Renda (Nominal) - ${raca.toUpperCase()}`, font: { size: 16 } },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) label += ': ';
                                    let val = context.raw;
                                    if (typeof val === 'object') val = val.y; // Se for scatter
                                    if (val >= 1e6) return label + 'R$ ' + (val/1e6).toFixed(2) + ' Mi';
                                    return label + 'R$ ' + (val/1e3).toFixed(0) + ' k';
                                }
                            }
                        }
                    },
                    scales: {
                        x: { title: { display: true, text: 'Idade' } },
                        y: { 
                            title: { display: true, text: 'Acumulado (R$)' },
                            ticks: { callback: (val) => 'R$ ' + (val/1e6).toFixed(1) + ' Mi' }
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>


