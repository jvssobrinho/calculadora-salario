<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador de Sal√°rios Brasil 2025</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .card { box-shadow: 0 8px 16px rgba(0,0,0,0.08); border: none; border-radius: 15px; }
        .header-bg { background: linear-gradient(135deg, #0d6efd, #0043a8); color: white; padding: 3rem 0; margin-bottom: 2rem; }
        
        .result-box { 
            background-color: #ffffff; 
            border: 1px solid #dee2e6;
            border-left: 5px solid #198754;
            border-radius: 8px; 
            padding: 30px; 
            text-align: center; 
            display: none; 
            margin-top: 30px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            animation: fadeIn 0.6s ease-out;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .result-value { font-size: 3.5rem; font-weight: 800; color: #198754; letter-spacing: -1px; margin: 10px 0; }
        .result-range { font-size: 1.15rem; color: #495057; background-color: #f8f9fa; padding: 10px; border-radius: 8px; display: inline-block; margin-top: 10px; border: 1px solid #e9ecef; }
        .badge-uf { background-color: #e7f1ff; color: #0d6efd; padding: 6px 12px; border-radius: 30px; font-size: 0.9rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; }
        
        .btn-calc { padding: 15px; font-size: 1.2rem; font-weight: 700; transition: all 0.3s; }
        .btn-calc:hover { transform: translateY(-2px); box-shadow: 0 4px 10px rgba(13, 110, 253, 0.3); }

        footer a { color: inherit; text-decoration: none; border-bottom: 1px dotted #6c757d; }
        footer a:hover { color: #0d6efd; border-bottom: 1px solid #0d6efd; }
    </style>
</head>
<body class="d-flex flex-column min-vh-100">

    <div class="header-bg text-center">
        <h1 class="fw-bold display-5">üí∞ Simulador de Sal√°rios Brasil</h1>
        <p class="lead opacity-90">Baseado em dados da PNADc 2025 (IBGE) e Microeconometria</p>
    </div>

    <div class="container pb-5 flex-grow-1">
        <div class="row justify-content-center">
            <div class="col-md-8 col-lg-7">
                <div class="card p-4 p-md-5">
                    <form id="salaryForm">
                        <div class="row g-4 mb-4">
                            <div class="col-12">
                                <h5 class="text-primary fw-bold border-bottom pb-2">1. Seu Perfil</h5>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-bold text-secondary">Idade</label>
                                <input type="number" class="form-control form-control-lg" id="idade" value="30" min="14" max="80" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-bold text-secondary">Escolaridade</label>
                                <select class="form-select form-select-lg" id="estudo">
                                    <option value="0">Sem instru√ß√£o</option>
                                    <option value="4">Fundamental Incompleto</option>
                                    <option value="9">Fundamental Completo</option>
                                    <option value="12" selected>M√©dio Completo</option>
                                    <option value="16">Superior Completo</option>
                                    <option value="18">P√≥s-Gradua√ß√£o (Mestrado/Dout)</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-bold text-secondary">G√™nero</label>
                                <select class="form-select form-select-lg" id="sexo">
                                    <option value="homem">Homem</option>
                                    <option value="mulher">Mulher</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-bold text-secondary">Cor / Ra√ßa</label>
                                <select class="form-select form-select-lg" id="cor">
                                    <option value="branca">Branca / Amarela / Ind√≠gena</option>
                                    <option value="preta">Preta / Parda</option>
                                </select>
                            </div>
                        </div>

                        <div class="row g-4 mb-4">
                            <div class="col-12">
                                <h5 class="text-primary fw-bold border-bottom pb-2 mt-3">2. Mercado de Trabalho</h5>
                            </div>
                            <div class="col-12">
                                <label class="form-label fw-bold text-secondary">Setor de Atividade</label>
                                <select class="form-select form-select-lg" id="setor">
                                    <option value="1">Agricultura, Pecu√°ria e Silvicultura</option>
                                    <option value="2">Ind√∫stria Extrativa</option>
                                    <option value="3" selected>Ind√∫stria de Transforma√ß√£o</option>
                                    <option value="4">Eletricidade e G√°s</option>
                                    <option value="5">√Ågua, Esgoto e Gest√£o de Res√≠duos</option>
                                    <option value="6">Constru√ß√£o Civil</option>
                                    <option value="7">Com√©rcio e Repara√ß√£o de Ve√≠culos</option>
                                    <option value="8">Transporte, Armazenagem e Correio</option>
                                    <option value="9">Alojamento e Alimenta√ß√£o</option>
                                    <option value="10">Informa√ß√£o e Comunica√ß√£o (TI)</option>
                                    <option value="11">Administra√ß√£o P√∫blica e Defesa</option>
                                    <option value="12">Educa√ß√£o, Sa√∫de e Servi√ßos Sociais</option>
                                </select>
                            </div>
                            <div class="col-12">
                                <label class="form-label fw-bold text-secondary">Estado (UF) para Simula√ß√£o</label>
                                <select class="form-select form-select-lg" id="uf">
                                    <option value="11">Rond√¥nia (RO)</option>
                                    <option value="12">Acre (AC)</option>
                                    <option value="13">Amazonas (AM)</option>
                                    <option value="14">Roraima (RR)</option>
                                    <option value="15">Par√° (PA)</option>
                                    <option value="16">Amap√° (AP)</option>
                                    <option value="17">Tocantins (TO)</option>
                                    <option value="21">Maranh√£o (MA)</option>
                                    <option value="22">Piau√≠ (PI)</option>
                                    <option value="23">Cear√° (CE)</option>
                                    <option value="24">Rio Grande do Norte (RN)</option>
                                    <option value="25">Para√≠ba (PB)</option>
                                    <option value="26">Pernambuco (PE)</option>
                                    <option value="27">Alagoas (AL)</option>
                                    <option value="28">Sergipe (SE)</option>
                                    <option value="29">Bahia (BA)</option>
                                    <option value="31">Minas Gerais (MG)</option>
                                    <option value="32">Esp√≠rito Santo (ES)</option>
                                    <option value="33">Rio de Janeiro (RJ)</option>
                                    <option value="35" selected>S√£o Paulo (SP)</option>
                                    <option value="41">Paran√° (PR)</option>
                                    <option value="42">Santa Catarina (SC)</option>
                                    <option value="43">Rio Grande do Sul (RS)</option>
                                    <option value="50">Mato Grosso do Sul (MS)</option>
                                    <option value="51">Mato Grosso (MT)</option>
                                    <option value="52">Goi√°s (GO)</option>
                                    <option value="53">Distrito Federal (DF)</option>
                                </select>
                            </div>
                        </div>

                        <div class="d-grid mt-5">
                            <button type="button" class="btn btn-primary btn-calc shadow" onclick="calcularSalario()">
                                Calcular Estimativa
                            </button>
                        </div>
                    </form>

                    <div id="resultado" class="result-box">
                        <span class="badge-uf" id="badgeUF">M√©dia Estimada</span>
                        <div class="result-value" id="valorEstimado">R$ 0,00</div>
                        
                        <div class="result-range">
                            <span>Faixa prov√°vel (95% confian√ßa):</span><br>
                            <strong id="faixaMin" class="text-dark">R$ 0,00</strong> 
                            <span class="text-muted mx-2">at√©</span> 
                            <strong id="faixaMax" class="text-dark">R$ 0,00</strong>
                        </div>
                        
                        <p class="mt-4 mb-0 text-muted small fst-italic">
                            *Valores brutos mensais estimados para jornada de 40h semanais. <br>
                            A "faixa prov√°vel" indica a varia√ß√£o salarial natural para este perfil devido a fatores n√£o observ√°veis.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="mt-auto py-4 bg-white border-top text-center text-secondary">
        <div class="container">
            <p class="mb-1 fw-bold text-dark">Jo√£o Vitor dos Santos Sobrinho <span class="fw-normal text-muted">(Economia/UEFS)</span></p>
            <p class="mb-0 small">Projeto acad√™mico de Microeconometria Aplicada.</p>
        </div>
    </footer>

    <script>
        let modelo = null;

        // IMPORTANTE: O nome do arquivo JSON deve ser exato
        fetch('modelo_salario_coeficientes_2025_geral.json') 
            .then(response => {
                if (!response.ok) throw new Error("Erro HTTP: " + response.status);
                return response.json();
            })
            .then(data => {
                modelo = data;
                console.log("Modelo carregado com sucesso!", modelo.meta_info);
            })
            .catch(error => {
                console.error('Erro ao carregar JSON:', error);
                alert('Erro: N√£o foi poss√≠vel carregar os dados do modelo. Verifique se o arquivo JSON est√° na mesma pasta.');
            });

        function calcularSalario() {
            if (!modelo) {
                alert("Aguarde, carregando dados do modelo...");
                return;
            }

            const coef = modelo.coeficientes;
            
            // --- CORRE√á√ÉO DE SEGURAN√áA ---
            // Se o sigma vier do JSON com valor absurdo (erro de peso), usamos 0.65.
            let sigma = modelo.meta_info.sigma_resid;
            if (!sigma || sigma > 5) {
                console.warn("Sigma do JSON suspeito (" + sigma + "). Usando valor padr√£o 0.65.");
                sigma = 0.65; 
            }

            // 1. Coleta Inputs
            const idade = parseFloat(document.getElementById('idade').value);
            const anosEstudo = parseFloat(document.getElementById('estudo').value);
            const sexo = document.getElementById('sexo').value;
            const cor = document.getElementById('cor').value;
            const setor = document.getElementById('setor').value;
            const uf = document.getElementById('uf').value;

            // 2. Experi√™ncia Minceriana
            let experiencia = idade - anosEstudo - 6;
            if (experiencia < 0) {
                experiencia = 0; // Evita experi√™ncia negativa
            }
            let experiencia2 = experiencia * experiencia;

            // 3. Soma dos Coeficientes (Log-Linear)
            let score = coef['const'] || coef['Intercepto'] || 1.2;

            score += (coef['Anos_Estudo'] || 0) * anosEstudo;
            score += (coef['Experiencia'] || 0) * experiencia;
            score += (coef['Experiencia_2'] || 0) * experiencia2;

            // Dummies
            if (sexo === 'mulher') score += (coef['d_mulher'] || 0);
            if (cor === 'preta') score += (coef['d_preto_pardo'] || 0);

            // UF
            let chaveUF = `UF_${uf}`;
            if (coef[chaveUF]) score += coef[chaveUF];

            // Setor
            let chaveSetor = `setor_${setor}`;
            if (coef[chaveSetor]) score += coef[chaveSetor];

            // IMR (Corre√ß√£o Vi√©s de Sele√ß√£o)
            if (coef['IMR']) score += coef['IMR'] * 0.6; // M√©dia estimada do IMR na popula√ß√£o

            // 4. C√°lculo dos Intervalos (Log Scale)
            // Intervalo de Confian√ßa de 95% (z ‚âà 1.96)
            let log_medio = score;
            let log_min = score - (1.96 * sigma);
            let log_max = score + (1.96 * sigma);

            // 5. Transforma√ß√£o para Reais (Exponencial)
            // 4.5 semanas * 40 horas = 180 horas mensais
            const horasMensais = 180; 
            
            let salarioMedio = Math.exp(log_medio) * horasMensais;
            let salarioMin = Math.exp(log_min) * horasMensais;
            let salarioMax = Math.exp(log_max) * horasMensais;

            // Ajuste visual para valores muito baixos (opcional, mas evita R$ 50,00)
            if (salarioMin < 0) salarioMin = 0;

            // 6. Atualiza√ß√£o da Interface
            const fmt = new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' });

            document.getElementById('valorEstimado').innerText = fmt.format(salarioMedio);
            document.getElementById('faixaMin').innerText = fmt.format(salarioMin);
            document.getElementById('faixaMax').innerText = fmt.format(salarioMax);
            
            const nomeUF = document.getElementById('uf').options[document.getElementById('uf').selectedIndex].text;
            document.getElementById('badgeUF').innerText = `Estimativa para: ${nomeUF}`;

            // Efeito de aparecer
            const resultBox = document.getElementById('resultado');
            resultBox.style.display = 'block';
            resultBox.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
    </script>

</body>
</html>
