<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador Microeconomﾃｩtrico Brasil 2025 (Estratificado)</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body { background-color: #f8f9fa; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .card { box-shadow: 0 8px 16px rgba(0,0,0,0.08); border: none; border-radius: 15px; }
        .header-bg { background: linear-gradient(135deg, #1e3c72, #2a5298); color: white; padding: 3rem 0; margin-bottom: 2rem; }
        
        /* Estilos da Calculadora */
        .result-box { 
            background-color: #ffffff; 
            border: 1px solid #dee2e6;
            border-left: 5px solid #198754;
            border-radius: 8px; 
            padding: 30px; 
            text-align: center; 
            display: none; 
            margin-top: 30px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            animation: fadeIn 0.6s ease-out;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .result-value { font-size: 3.5rem; font-weight: 800; color: #198754; letter-spacing: -1px; margin: 10px 0; }
        .badge-uf { background-color: #e7f1ff; color: #0d6efd; padding: 6px 12px; border-radius: 30px; font-size: 0.9rem; font-weight: 700; text-transform: uppercase; }
        .badge-modelo { background-color: #fff3cd; color: #856404; padding: 5px 10px; border-radius: 20px; font-size: 0.8rem; font-weight: bold; margin-bottom: 10px; display: inline-block; }

        /* Botﾃｵes */
        .btn-calc { padding: 15px; font-size: 1.2rem; font-weight: 700; transition: all 0.3s; }
        .btn-calc:hover { transform: translateY(-2px); box-shadow: 0 4px 10px rgba(13, 110, 253, 0.3); }

        /* Navegaﾃｧﾃ｣o */
        .nav-pills .nav-link { color: #495057; font-weight: 600; padding: 12px 25px; border-radius: 30px; margin: 0 5px; }
        .nav-pills .nav-link.active { background-color: #1e3c72; color: white; }
        
        #chart-container { position: relative; height: 500px; width: 100%; margin-top: 20px; }
        footer a { color: inherit; text-decoration: none; border-bottom: 1px dotted #6c757d; }
    </style>
</head>
<body class="d-flex flex-column min-vh-100">

    <div class="header-bg text-center">
        <h1 class="fw-bold display-5">投 Simulador de Renda Brasil</h1>
        <p class="lead opacity-90">Modelos Economﾃｩtricos Estratificados por Raﾃｧa (PNADc 2025)</p>
    </div>

    <div class="container pb-5 flex-grow-1">
        
        <ul class="nav nav-pills justify-content-center mb-5" id="pills-tab" role="tablist">
            <li class="nav-item">
                <button class="nav-link active" id="pills-calc-tab" data-bs-toggle="pill" data-bs-target="#pills-calc" type="button">Calculadora Instantﾃ｢nea</button>
            </li>
            <li class="nav-item">
                <button class="nav-link" id="pills-sim-tab" data-bs-toggle="pill" data-bs-target="#pills-sim" type="button" onclick="simularVida()">Curva de Vida (Educaﾃｧﾃ｣o)</button>
            </li>
        </ul>

        <div class="tab-content" id="pills-tabContent">
            
            <div class="tab-pane fade show active" id="pills-calc" role="tabpanel">
                <div class="row justify-content-center">
                    <div class="col-md-8 col-lg-7">
                        <div class="card p-4 p-md-5">
                            <form id="salaryForm">
                                <div class="row g-4 mb-4">
                                    <div class="col-12"><h5 class="text-primary fw-bold border-bottom pb-2">1. Perfil Demogrﾃ｡fico</h5></div>
                                    
                                    <div class="col-12">
                                        <label class="form-label fw-bold text-danger">Cor / Raﾃｧa (Define o Modelo Estatﾃｭstico)</label>
                                        <select class="form-select form-select-lg border-danger" id="cor">
                                            <option value="branca">Branca / Amarela</option>
                                            <option value="preta">Preta / Parda</option>
                                            <option value="indigena">Indﾃｭgena</option>
                                        </select>
                                        <div class="form-text">Selecionar a raﾃｧa carrega coeficientes especﾃｭficos de retorno salarial para este grupo.</div>
                                    </div>

                                    <div class="col-md-6">
                                        <label class="form-label fw-bold text-secondary">Idade</label>
                                        <input type="number" class="form-control form-control-lg" id="idade" value="28" min="14" max="80">
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold text-secondary">Escolaridade</label>
                                        <select class="form-select form-select-lg" id="estudo">
                                            <option value="0">Sem instruﾃｧﾃ｣o</option>
                                            <option value="4">Fundamental Incompleto</option>
                                            <option value="9">Fundamental Completo</option>
                                            <option value="12" selected>Mﾃｩdio Completo</option>
                                            <option value="16">Superior Completo</option>
                                            <option value="18">Pﾃｳs-Graduaﾃｧﾃ｣o</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold text-secondary">Gﾃｪnero</label>
                                        <select class="form-select form-select-lg" id="sexo">
                                            <option value="homem">Homem</option>
                                            <option value="mulher">Mulher</option>
                                        </select>
                                    </div>
                                    
                                    <div class="col-12"><h5 class="text-primary fw-bold border-bottom pb-2 mt-3">2. Mercado de Trabalho</h5></div>
                                    
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold text-secondary">Estado (UF)</label>
                                        <select class="form-select form-select-lg" id="uf">
                                            <option value="35" selected>Sﾃ｣o Paulo (SP)</option>
                                            <option value="29">Bahia (BA)</option>
                                            <option value="33">Rio de Janeiro (RJ)</option>
                                            <option value="31">Minas Gerais (MG)</option>
                                            <option value="53">Distrito Federal (DF)</option>
                                            <option value="43">Rio Grande do Sul (RS)</option>
                                            <option value="13">Amazonas (AM)</option>
                                            <option value="23">Cearﾃ｡ (CE)</option>
                                            <option value="26">Pernambuco (PE)</option>
                                            </select>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold text-secondary">Setor</label>
                                        <select class="form-select form-select-lg" id="setor">
                                            <option value="3">Indﾃｺstria</option>
                                            <option value="6">Construﾃｧﾃ｣o Civil</option>
                                            <option value="7" selected>Comﾃｩrcio</option>
                                            <option value="8">Transportes</option>
                                            <option value="11">Adm. Pﾃｺblica</option>
                                            <option value="12">Educaﾃｧﾃ｣o e Saﾃｺde</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="d-grid mt-4">
                                    <button type="button" class="btn btn-primary btn-calc shadow" onclick="calcularSalario()">Calcular Renda Estimada</button>
                                </div>
                            </form>

                            <div id="resultado" class="result-box">
                                <span class="badge-modelo" id="infoModelo">Carregando...</span><br>
                                <span class="badge-uf" id="badgeUF">Mﾃｩdia Estimada</span>
                                <div class="result-value" id="valorEstimado">R$ 0,00</div>
                                <div class="text-muted small">
                                    Faixa provﾃ｡vel (95% confianﾃｧa): <strong id="faixaMin">R$ 0</strong> atﾃｩ <strong id="faixaMax">R$ 0</strong>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="pills-sim" role="tabpanel">
                <div class="row justify-content-center">
                    <div class="col-lg-10">
                        <div class="card p-4">
                            <h4 class="mb-3">Trajetﾃｳria de Renda Vitalﾃｭcia</h4>
                            <p class="text-muted">Compare o impacto financeiro de diferentes nﾃｭveis de escolaridade ao longo da vida para o perfil selecionado.</p>
                            
                            <div class="row g-3 p-3 bg-light rounded mb-4 border align-items-end">
                                <div class="col-md-4">
                                    <label class="form-label fw-bold small text-danger">Modelo Racial</label>
                                    <select class="form-select border-danger" id="sim_cor" onchange="simularVida()">
                                        <option value="branca">Branca / Amarela</option>
                                        <option value="preta">Preta / Parda</option>
                                        <option value="indigena">Indﾃｭgena</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label fw-bold small">Inflaﾃｧﾃ｣o Anual (%)</label>
                                    <input type="number" id="sim_inflacao" class="form-control" value="5.5" step="0.5">
                                </div>
                                <div class="col-md-3">
                                    <button class="btn btn-success w-100 fw-bold shadow-sm" onclick="simularVida()">Atualizar Grﾃ｡fico</button>
                                </div>
                            </div>

                            <div id="chart-container">
                                <canvas id="lifeChart"></canvas>
                            </div>
                            <div id="insights" class="mt-3 alert alert-secondary text-center small">Selecione o grupo acima para gerar insights.</div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <footer class="mt-auto py-4 bg-white border-top text-center text-secondary">
        <div class="container">
            <p class="mb-1 fw-bold text-dark">Joﾃ｣o Vitor dos Santos Sobrinho <span class="fw-normal text-muted">(Economia/UEFS)</span></p>
            <p class="mb-0 small">Projeto acadﾃｪmico de Microeconometria Aplicada.</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        let dadosJSON = null;
        let myChart = null;

        // 1. CARREGAR JSON
        fetch('modelo_salario_coeficientes_2025_geral.json')
            .then(res => {
                if(!res.ok) throw new Error("JSON nﾃ｣o encontrado");
                return res.json();
            })
            .then(data => {
                dadosJSON = data;
                console.log("Modelos carregados:", Object.keys(data));
            })
            .catch(err => alert("Erro ao carregar modelo: " + err.message));

        // 2. FUNﾃﾃグ CALCULAR (MODIFICADA PARA JSON ESTRATIFICADO)
        function calcularSalario() {
            if (!dadosJSON) return alert("Aguarde o carregamento dos dados...");

            // Inputs
            const raca = document.getElementById('cor').value;
            const idade = parseFloat(document.getElementById('idade').value);
            const anosEstudo = parseFloat(document.getElementById('estudo').value);
            const sexo = document.getElementById('sexo').value;
            const uf = document.getElementById('uf').value;
            const setor = document.getElementById('setor').value;

            // --- SELEﾃﾃグ DO SUB-MODELO ---
            const modeloAtual = dadosJSON[raca];
            
            if (!modeloAtual) {
                return alert("Erro: Nﾃ｣o hﾃ｡ dados no JSON para o grupo " + raca);
            }

            const coef = modeloAtual.coeficientes;
            const meta = modeloAtual.meta_info;

            // Variﾃ｡veis
            let experiencia = Math.max(0, idade - anosEstudo - 6);
            let experiencia2 = experiencia * experiencia;

            // Cﾃ｡lculo Score
            let score = coef['const']; // Intercepto especﾃｭfico da raﾃｧa

            if(coef['Anos_Estudo']) score += coef['Anos_Estudo'] * anosEstudo;
            if(coef['Experiencia']) score += coef['Experiencia'] * experiencia;
            if(coef['Experiencia_2']) score += coef['Experiencia_2'] * experiencia2;
            
            // Dummies
            if (sexo === 'mulher' && coef['d_mulher']) score += coef['d_mulher'];
            
            // Nota: Nﾃグ ADICIONAMOS MAIS 'd_preto_pardo' MANUALMENTE
            // Pois o modelo 'preta' ou 'indigena' jﾃ｡ tem seus prﾃｳprios coeficientes.

            if (coef[`UF_${uf}`]) score += coef[`UF_${uf}`];
            if (coef[`setor_${setor}`]) score += coef[`setor_${setor}`];

            if (coef['IMR']) score += coef['IMR'] * 0.6; // Correﾃｧﾃ｣o Heckman

            // Resultados
            let salarioMedio = Math.exp(score) * 180; // Mensal (aprox 180h)
            
            let sigma = meta.sigma_resid || 0.65;
            let min = Math.exp(score - 1.96 * sigma) * 180;
            let max = Math.exp(score + 1.96 * sigma) * 180;

            // Formataﾃｧﾃ｣o
            const fmt = new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' });
            
            document.getElementById('valorEstimado').innerText = fmt.format(salarioMedio);
            document.getElementById('faixaMin').innerText = fmt.format(min);
            document.getElementById('faixaMax').innerText = fmt.format(max);
            
            const nomes = { 'branca': 'Populaﾃｧﾃ｣o Branca/Amarela', 'preta': 'Populaﾃｧﾃ｣o Preta/Parda', 'indigena': 'Populaﾃｧﾃ｣o Indﾃｭgena' };
            document.getElementById('infoModelo').innerText = `Modelo Aplicado: ${nomes[raca]}`;
            
            const box = document.getElementById('resultado');
            box.style.display = 'block';
            box.scrollIntoView({ behavior: 'smooth' });
        }

        // 3. SIMULAﾃﾃグ DE VIDA
        function simularVida() {
            if (!dadosJSON) return;

            const raca = document.getElementById('sim_cor').value;
            const inflacao = parseFloat(document.getElementById('sim_inflacao').value) / 100;
            const modeloAtual = dadosJSON[raca];
            const coef = modeloAtual.coeficientes;

            // Cenﾃ｡rios
            const cenarios = [
                { label: "Mﾃｩdio (12 anos)", anos: 12, inicio: 18, cor: '#ffc107' },
                { label: "Superior (16 anos)", anos: 16, inicio: 22, cor: '#0d6efd' },
                { label: "Mestrado (18 anos)", anos: 18, inicio: 24, cor: '#198754' }
            ];

            const labels = [];
            const datasets = [];

            cenarios.forEach(c => {
                datasets.push({
                    label: c.label,
                    data: [],
                    borderColor: c.cor,
                    backgroundColor: c.cor,
                    tension: 0.4
                });
            });

            // Loop 18 a 65 anos
            for (let t = 18; t <= 65; t++) {
                labels.push(t);
                
                cenarios.forEach((c, idx) => {
                    if (t < c.inicio) {
                        datasets[idx].data.push(null);
                    } else {
                        let exp = t - c.anos - 6;
                        let exp2 = exp * exp;
                        
                        let s = coef['const'];
                        s += coef['Anos_Estudo'] * c.anos;
                        s += coef['Experiencia'] * exp;
                        s += coef['Experiencia_2'] * exp2;
                        
                        // Fixando variﾃ｡veis mﾃｩdias para o grﾃ｡fico
                        if(coef['UF_35']) s += coef['UF_35']; // SP
                        if(coef['setor_7']) s += coef['setor_7']; // Comﾃｩrcio

                        let real = Math.exp(s) * 180;
                        let nominal = real * Math.pow(1 + inflacao, (t - 18));
                        
                        datasets[idx].data.push(nominal);
                    }
                });
            }

            // Renderizar Grﾃ｡fico
            const ctx = document.getElementById('lifeChart').getContext('2d');
            if (myChart) myChart.destroy();

            myChart = new Chart(ctx, {
                type: 'line',
                data: { labels, datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        title: { display: true, text: `Projeﾃｧﾃ｣o Salarial Nominal - ${raca.toUpperCase()}` },
                        tooltip: { callbacks: { label: (c) => `R$ ${c.raw.toFixed(0)}` } }
                    },
                    scales: { y: { title: {display:true, text:'Renda Mensal (R$)'} } }
                }
            });

            // Insights
            const fimSup = datasets[1].data.at(-1);
            const fimMed = datasets[0].data.at(-1);
            const premio = ((fimSup/fimMed) - 1) * 100;
            
            document.getElementById('insights').innerHTML = `
                <strong>Insight Automﾃ｡tico:</strong> Para o grupo <span class='text-uppercase'>${raca}</span>, 
                o Ensino Superior projeta um salﾃ｡rio final <strong>${premio.toFixed(1)}% maior</strong> 
                que o Ensino Mﾃｩdio aos 65 anos.
            `;
        }
    </script>
</body>
</html>
